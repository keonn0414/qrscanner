

<!DOCTYPE html>
<html>
<head>
    <title>Add Receiving Item</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;500;600;700;800&family=Fauna+One&family=Poppins:ital,wght@0,100;0,300;0,400;0,500;0,700;1,100&display=swap" rel="stylesheet">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="stylesheet" href="../stylesheet_folder/index_style.css">
    <!-- JavaScript Includes -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.1/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <!-- SELECT2 LIBRARY CDN'S -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/css/select2.min.css" rel="stylesheet" />
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/js/select2.min.js"></script>

</head>
<body>
    <div class="container-fluid">
        <div class="row">
            <div id="page_title" class="col-md-5">
                <h3 class="mt-3">ADD RECEIVING ITEM</h3>
            </div>
            <div id="footer_logout" class="col-md-7">    
                  
            </div>
        </div>
        <div class="row">
            <div class="col-md-3">
                <a id="back_button" class="btn btn-secondary" href="../receiving_management.php">&larr; Back to Receiving Management</a>
            </div>
        </div>
        <!-- Display the success message here -->
        

        <!-- Display the QR code form -->
        <form id="receivingForm" method="post">
            <!-- QR Scanner start here -->
            <div id="qr_display" class="row">
                <script src="html5-qrcode.min.js"></script>
                <style>
                .result{
                    background-color: green;
                    color:#fff;
                    padding:20px;
                }
                .row{
                    display:flex;
                }
                </style>
                <div class="row mt-5">
                <div class="mb-3">
                    <div id="reader"></div>
                </div>
                <!--<div class="col" style="padding:30px;">
                    <h4>SCAN RESULT</h4>
                    <div id="result">Result Here</div>
                </div>-->
                </div>
                <script type="text/javascript">
                /* function onScanSuccess(qrCodeMessage) {
                    document.getElementById('qr_code').value = qrCodeMessage;
                    //document.getElementById('result').innerHTML = '<span class="result">'+qrCodeMessage+'</span>';
                }
                function onScanError(errorMessage) {
                //handle scan error
                }
                var html5QrcodeScanner = new Html5QrcodeScanner(
                    "reader", { fps: 10, qrbox: 250 });
                html5QrcodeScanner.render(onScanSuccess, onScanError); */
                const html5QrCode = new Html5Qrcode("reader");
                const qrCodeSuccessCallback = (decodedText, decodedResult) => {
                    /* handle success */
                    document.getElementById('qr_code').value = decodedResult;
                };
                const config = { fps: 10, qrbox: { width: 250, height: 250 } };

                // If you want to prefer front camera
                //html5QrCode.start({ facingMode: "user" }, config, qrCodeSuccessCallback);

                // If you want to prefer back camera
                //html5QrCode.start({ facingMode: "environment" }, config, qrCodeSuccessCallback);

                // Select front camera or fail with `OverconstrainedError`.
                //html5QrCode.start({ facingMode: { exact: "user"} }, config, qrCodeSuccessCallback);

                // Select back camera or fail with `OverconstrainedError`.
                html5QrCode.start({ facingMode: { exact: "environment"} }, config, qrCodeSuccessCallback);
                //html5QrCode.start({ deviceId: { exact: cameraId} }, config, qrCodeSuccessCallback);
                </script>
            </div>
            <!-- QR Scanner end here -->
            <div class="mb-3">
                <label for="qr_code" class="form-label">QR Code:</label>
                <input type="text" id="qr_code" name="qr_code" class="form-control" placeholder="Enter QR code number here" required >
            </div>
            <div class="mb-3">
                <label for="item_info" class="form-label">Select Item:</label>
                <select id="item_info" name="item_info" class="form-control" required data-live-search="true">
                    <option value="" data-box-price="" data-cutting-price="">Select an item</option>
                    
                </select>
            </div>
            <div class="mb-3">
                <label for="BuyingPrice" class="form-label">Buying Price</label>
                <input type="number" step="any" id="BuyingPrice" name="BuyingPrice" class="form-control" required value="<?php echo $BuyingPrice; ?>" onchange="GetPrice();" onkeydown="GetPrice();" onkeyup="GetPrice();">
            </div>
            <!-- <div class="mb-3">
                <label for="box_price" class="form-label">Box Price:</label>
                <input type="text" id="box_price" name="box_price" class="form-control" readonly value="<?php //echo $boxPrice; ?>">
            </div>
            <div class="mb-3">
                <label for="cutting_price" class="form-label">Cutting Price:</label>
                <input type="text" id="cutting_price" name="cutting_price" class="form-control" readonly value="<?php //echo $cuttingPrice; ?>">
            </div> -->
            
            <div class="mb-3">
                <label for="qty" class="form-label">Receiving Qty (KG):</label>
                <input type="number" id="qty" name="qty" class="form-control" required value="<?php echo $qty; ?>" onchange="GetPrice();" onkeydown="GetPrice();" onkeyup="GetPrice();" step="any">
            </div>
            <div class="mb-3">
                <label for="TotalPrice" class="form-label">Total Price:</label>
                <input type="number" id="TotalPrice" name="TotalPrice" class="form-control" required value="<?php echo $TotalPrice; ?>" readonly step="any">
            </div>
            <div class="row">
                <div class="col-md-2">
                    <input id="add_stock" class="btn btn-primary" type="submit" value="Save">
                </div>
            </div>
        </form>
            
    </div>

    <!-- Add this JavaScript code inside your HTML file, preferably just before the closing </body> tag -->
<script type="text/javascript">
    function GetPrice(){
        var BuyingPrice = $('#BuyingPrice').val();
        var qty = $('#qty').val();
        TotalPrice = BuyingPrice * qty;
        //TotalPrice = ReplaceNumberWithCommas(TotalPrice);
        $('#TotalPrice').val(TotalPrice);


    }
    function ReplaceNumberWithCommas(yourNumber) {
    //Seperates the components of the number
    var n= yourNumber.toString().split(".");
    //Comma-fies the first part
    n[0] = n[0].replace(/\B(?=(\d{3})+(?!\d))/g, ",");
    //Combines the two sections
    return n.join(".");
}
    // Function to update box_price and cutting_price based on the selected item
    function updatePrices() {
        const itemInfoSelect = document.getElementById('item_info');
        const boxPriceInput = document.getElementById('box_price');
        const cuttingPriceInput = document.getElementById('cutting_price');
        
        // Get the selected item's data attributes
        const selectedItem = itemInfoSelect.options[itemInfoSelect.selectedIndex];
        const boxPrice = selectedItem.getAttribute('data-box-price');
        const cuttingPrice = selectedItem.getAttribute('data-cutting-price');
        
        // Update the input fields with the selected item's prices
        boxPriceInput.value = boxPrice;
        cuttingPriceInput.value = cuttingPrice;
    }
    
    // Attach the updatePrices function to the change event of the item_info select element
    const itemInfoSelect = document.getElementById('item_info');
    itemInfoSelect.addEventListener('change', updatePrices);
    
    // Initialize prices on page load
    updatePrices();
</script>
<!-- NEW SCRIPT FOR THE SEARCH BAR ON THE LIST OF ITEM ON RECEIVING -->
<script>
    $(document).ready(function () {
        // Initialize Select2 on your select element
        $("#item_info").select2();
    });
</script>

</body>
</html>
